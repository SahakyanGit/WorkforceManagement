@using WorkforceManagement.DTO.Models;
@using System.Text;
@model  IEnumerable<EmployeeDto>
@{
    ViewData["Title"] = "Index";
    string value = "false";
    byte[] b = new byte[] { };
    var exist = Context.Session.TryGetValue("IsAuth", out b);
    value = b != null ? Encoding.ASCII.GetString(b) : value;
    bool isAuthenticated = Convert.ToBoolean(value);
}

@if (isAuthenticated)
{
    <link rel="stylesheet" href="~/lib/bootstrap-year-calendar/css/bootstrap-year-calendar.css" />
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap-theme.css" />
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="~/lib/sweetalert/dist/sweetalert.css">
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.js"></script>
    <br />
            <button class="btn-calendar btn btn-primary">Show Calendar</button>
            <br />
            <div class="calender-div" data-provide="calendar" style="display:none"></div>
            <input type="tel" placeholder="add new skill" id="skill" class="form-control" name="skill" size="30" />
            <br />
            <button id="skill-btn" class="btn btn-primary" value="add">Add skill</button>
            <br />
            <div id="bar"></div>
            <br />
            <button id="save-btn" class="btn btn-default">Save</button>

            <a href='@Url.Action("Create", "Home")' onclick='navigate(this.href);'>

            </a>
            <script>
                $('#skill-btn').click(function () {
                    value = document.getElementById("skill").value;

                    if (value == "") {
                        alert("Please a dd skill");
                    }
                    else {
                        $.getJSON("../js/data.json", function (data) {
                            var item = data
                            $('#bar').append("<div id='" + item.Count + "'><label id ='l" + item.Count + "'>" + (value) + '   ' + "</label><button data-toggle='progressbar' data-target='#" + item.Count + "'  data-value='0' class='btn btn-danger'>don't know</button><button data-toggle='progressbar' data-target='#" + item.Count + "' data-value='25' class='btn btn-warning'>basic</button><button data-toggle='progressbar' data-target='#" + item.Count + "' data-value='50' class='btn btn-info'>normal</button><button data-toggle='progressbar' data-target='#" + item.Count + "' data-value='75' class='btn btn-primary'>good</button><button data-toggle='progressbar' data-target='#" + item.Count + "' data-value='100' class='btn btn-success'>complete</button><div id='" + item.Count + "' class='progress'><div class='progress-bar' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100' style='width: 0%;'><span id='sr-only" + item.Count + "' class='sr-only'></span></div></div></div>");
                            item.Count++;
                            var datas = JSON.stringify(item);
                            $.ajax({
                                url: "/Home/JsonConfig",
                                type: "POST",
                                data: datas,
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                error: function (response) {
                                    alert(response.responseText);
                                    alert("err")
                                },
                                success: function (response) {
                                    swal("Good job!", "You have just added a new skill!", "success")
                                }
                            });
                        })
                    }
                });

                $("#save-btn").click(function () {
                    $.getJSON("../js/data.json", function (data) {
                        for (var i = 1; i < data.Count; i++) {
                            console.log("start")
                            var percent = $("#sr-only" + i + "").text();
                            console.log(percent)
                            var skill = $("#l" + i + "").text();
                            var items = {
                                SkillName: "" + skill + "", SkillKnowledge: "" + percent + ""
                            };
                            console.log(items);
                            var data = JSON.stringify(items);

                            $.ajax({
                                url: "/Home/Index",
                                type: "POST",
                                data: data,
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                error: function (response) {
                                    alert(response.responseText);
                                    alert("err")
                                },
                                success: function (response) {
                                    alert(response);
                                    console.log("success")
                                    alert("success")
                                }
                            });
                        }
                    })
                });
            </script>
            <script src="~/lib/sweetalert/dist/sweetalert.min.js"></script>
            <script src="~/lib/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.js"></script>
            <script src="~/js/calendar.js"></script>
            <script src="~/js/progressbar.js"></script>
            <script src="~/lib/bootstrap-year-calendar/js/bootstrap-year-calendar.js"></script>
}
else
{
    <h2>Please log in</h2>
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <title>Bootstrap Example</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="~/lib/bootstrap/dist/js/bootstrap.js">
    </head>
    <body>
        <div class="container">
            <h2>Users</h2>
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>email</th>
                        <th>password</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>admin@gmail.com</td>
                        <td>8888</td>
                    </tr>
                    <tr>
                        <td>user@gmail.com</td>
                        <td>1111</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </body>
</html>
}